<%- include('partials/header') %>

<section class="resume-preview-page">
  <div class="container">
    <div class="progress-tabs-wrapper">
      <ul class="progress-tabs disabled">
        <li class="tab">Personal details</li>
        <li class="tab">Contact information</li>
        <li class="tab">Professional summary</li>
        <li class="tab">Experience</li>
        <li class="tab">Projects</li>
        <li class="tab">Education</li>
        <li class="tab active">Skill & Hobbies</li>
      </ul>
    </div>

    <div class="preview-resume-wrapper">
      <!-- Resume Preview -->
      <div id="resumePreviewWrapper" data-resume-id="<%= resume.id %>" class="resume-preview-frame">
        <div class="resume-document">
          <div class="resume-header">
            <div class="resume-name-section">
              <h1><%= resume.personalInfo.firstName || '' %> <%= resume.personalInfo.lastName || '' %></h1>
              <h2><%= resume.personalInfo.jobTitle || '' %></h2>
            </div>
            <div class="resume-contact-section">
              <% if (resume.personalInfo.location) { %><p><%= resume.personalInfo.location %></p><% } %>
              <% if (resume.personalInfo.phone) { %><p><%= resume.personalInfo.phone %></p><% } %>
              <% if (resume.personalInfo.email) { %><p><%= resume.personalInfo.email %></p><% } %>
              <% if (resume.personalInfo.socials && resume.personalInfo.socials.length > 0) { %>
                <% resume.personalInfo.socials.forEach(social => { %>
                  <% if (social) { %><p><%= social %></p><% } %>
                <% }) %>
              <% } %>
            </div>
          </div>

          <% if (resume.personalInfo.summary) { %>
          <div class="resume-section">
            <h3>PROFESSIONAL SUMMARY</h3>
            <p><%= resume.personalInfo.summary %></p>
          </div>
          <% } %>

          <% if (resume.experience && resume.experience.length > 0 && (resume.experience[0].workTitle || resume.experience[0].workCompany)) { %>
          <div class="resume-section">
            <h3>EXPERIENCE</h3>
            <% resume.experience.forEach(exp => { %>
              <% if (exp.workTitle || exp.workCompany) { %>
              <div class="resume-entry">
                <div class="entry-header">
                  <span class="entry-title"><%= exp.workTitle || '' %></span>
                  <span class="entry-company"><%= exp.workCompany || '' %></span>
                  <span class="entry-date">
                    <% if (exp.startDate) { %>
                      <%= new Date(exp.startDate).toLocaleDateString('en-US', { year: 'numeric', month: 'short' }) %>
                    <% } %>
                    <% if (exp.startDate && exp.endDate) { %> - <% } %>
                    <% if (exp.endDate) { %>
                      <%= new Date(exp.endDate).toLocaleDateString('en-US', { year: 'numeric', month: 'short' }) %>
                    <% } %>
                  </span>
                </div>
                <% if (exp.location) { %>
                <div class="entry-location"><%= exp.location %></div>
                <% } %>
                <% if (exp.description) { %>
                <div class="entry-description"><%= exp.description %></div>
                <% } %>
              </div>
              <% } %>
            <% }) %>
          </div>
          <% } %>

          <% if (resume.projects && resume.projects.length > 0 && (resume.projects[0].title)) { %>
          <div class="resume-section">
            <h3>PROJECTS</h3>
            <% resume.projects.forEach(project => { %>
              <% if (project.title) { %>
              <div class="resume-entry">
                <div class="entry-header">
                  <span class="entry-title"><%= project.title %></span>
                  <% if (project.company) { %>
                  <span class="entry-company"><%= project.company %></span>
                  <% } %>
                </div>
                <% if (project.description) { %>
                <div class="entry-description"><%= project.description %></div>
                <% } %>
              </div>
              <% } %>
            <% }) %>
          </div>
          <% } %>

          <% if (resume.education && resume.education.length > 0 && (resume.education[0].degree || resume.education[0].institution)) { %>
          <div class="resume-section">
            <h3>EDUCATION</h3>
            <% resume.education.forEach(edu => { %>
              <% if (edu.degree || edu.institution) { %>
              <div class="resume-entry">
                <div class="entry-header">
                  <span class="entry-title"><%= edu.degree || '' %></span>
                  <span class="entry-institution"><%= edu.institution || '' %></span>
                  <span class="entry-date">
                    <% if (edu.startDate) { %>
                      <%= new Date(edu.startDate).toLocaleDateString('en-US', { year: 'numeric', month: 'short' }) %>
                    <% } %>
                    <% if (edu.startDate && edu.endDate) { %> - <% } %>
                    <% if (edu.endDate) { %>
                      <%= new Date(edu.endDate).toLocaleDateString('en-US', { year: 'numeric', month: 'short' }) %>
                    <% } %>
                  </span>
                </div>
                <% if (edu.location) { %>
                <div class="entry-location"><%= edu.location %></div>
                <% } %>
                <% if (edu.description) { %>
                <div class="entry-description"><%= edu.description %></div>
                <% } %>
              </div>
              <% } %>
            <% }) %>
          </div>
          <% } %>

          <% if ((resume.skills && (resume.skills.technical || resume.skills.soft)) || resume.personalInfo.hobbies) { %>
          <div class="resume-section">
            <% if (resume.skills && (resume.skills.technical || resume.skills.soft)) { %>
            <h3>SKILLS</h3>
            <div class="skills-container">
              <% if (resume.skills.technical) { %>
                <div class="skills-group">
                  <h4>Technical Skills</h4>
                  <ul class="skills-list">
                    <% if (Array.isArray(resume.skills.technical)) { %>
                      <% resume.skills.technical.forEach(skill => { %>
                        <li><%= skill %></li>
                      <% }) %>
                    <% } else { %>
                      <li><%= resume.skills.technical %></li>
                    <% } %>
                  </ul>
                </div>
              <% } %>
              
              <% if (resume.skills.soft) { %>
                <div class="skills-group">
                  <h4>Soft Skills</h4>
                  <ul class="skills-list">
                    <% if (Array.isArray(resume.skills.soft)) { %>
                      <% resume.skills.soft.forEach(skill => { %>
                        <li><%= skill %></li>
                      <% }) %>
                    <% } else { %>
                      <li><%= resume.skills.soft %></li>
                    <% } %>
                  </ul>
                </div>
              <% } %>
            </div>
            <% } %>
            
            <% if (resume.personalInfo.hobbies) { %>
            <h3>HOBBIES</h3>
            <p><%= resume.personalInfo.hobbies %></p>
            <% } %>
          </div>
          <% } %>
        </div>
      </div>

      <!-- Right side buttons -->
      <div class="preview-actions">
        <button class="icon-btn" id="btn-download" data-id="<%= resume.id %>" title="Download PDF">
          <img src="/img/icons/download-icon.png" alt="Download">
        </button>
        <button class="icon-btn" id="btn-share" title="Share Resume">
          <img src="/img/icons/share-icon.png" alt="Share">
        </button>
        <button class="icon-btn" id="btn-print" title="Print Resume">
          <img src="/img/icons/print-icon.png" alt="Print">
        </button>
      </div>
    </div>

    <!-- Edit button -->
    <div class="edit-footer">
      <a href="/resume/edit/<%= resume.id %>" class="btn btn-primary">Edit Resume</a>
      <a href="/resume/save-preview/<%= resume.id %>" class="btn btn-primary" style="background-color: #f5a623; margin-left: 10px;">Save & Return to Dashboard</a>
    </div>
  </div>
</section>

<style>
  .resume-preview-page {
    padding: 2rem 0;
    background-color: #e9e9e9;
    min-height: calc(100vh - var(--header-height) - var(--footer-height));
  }
  
  .progress-tabs-wrapper {
    margin-bottom: 2rem;
  }
  
  .progress-tabs.disabled {
    pointer-events: none;
    opacity: 0.7;
    display: flex;
    gap: 1rem;
    overflow-x: auto;
    background-color: white;
    padding: 0.5rem 1rem;
    border-radius: 8px;
  }
  
  .progress-tabs .tab {
    padding: 10px 12px;
    border-bottom: 2px solid #ddd;
    white-space: nowrap;
  }
  
  .progress-tabs .tab.active {
    border-color: black;
    font-weight: bold;
  }
  
  .preview-resume-wrapper {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    position: relative;
    padding: 1rem 0;
  }
  
  .resume-preview-frame {
    width: 800px;
    padding: 40px;
    background-color: #fff;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    margin-bottom: 2rem;
  }
  
  .resume-document {
    font-family: 'Arial', sans-serif;
    color: #333;
  }
  
  .resume-header {
    display: flex;
    justify-content: space-between;
    border-bottom: 2px solid #3498db;
    padding-bottom: 20px;
    margin-bottom: 25px;
  }
  
  .resume-name-section h1 {
    font-size: 28px;
    margin: 0 0 5px 0;
    color: #2c3e50;
  }
  
  .resume-name-section h2 {
    font-size: 16px;
    margin: 0;
    color: #7f8c8d;
    font-weight: normal;
  }
  
  .resume-contact-section {
    text-align: right;
    font-size: 14px;
  }
  
  .resume-contact-section p {
    margin: 0 0 5px 0;
  }
  
  .resume-section {
    margin-bottom: 25px;
  }
  
  .resume-section h3 {
    font-size: 16px;
    color: #2c3e50;
    border-bottom: 1px solid #ecf0f1;
    padding-bottom: 5px;
    margin-bottom: 15px;
    font-weight: bold;
  }
  
  .resume-entry {
    margin-bottom: 15px;
  }
  
  .entry-header {
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    margin-bottom: 5px;
  }

  .entry-title {
    font-weight: bold;
    color: #3498db;
  }
  
  .entry-company, .entry-institution {
    font-weight: bold;
  }
  
  .entry-date {
    color: #7f8c8d;
    font-size: 14px;
  }
  
  .entry-location {
    font-style: italic;
    margin-bottom: 5px;
  }
  
  .entry-description {
    font-size: 14px;
    margin-top: 5px;
  }
  
  .skills-container {
    display: flex;
    gap: 20px;
  }
  
  .skills-group {
    flex: 1;
  }
  
  .skills-group h4 {
    font-size: 15px;
    margin-bottom: 10px;
  }
  
  .skills-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  
  .skills-list li {
    margin-bottom: 5px;
    padding-left: 15px;
    position: relative;
  }
  
  .skills-list li:before {
    content: "•";
    position: absolute;
    left: 0;
    color: #3498db;
  }
  
  .preview-actions {
    display: flex;
    flex-direction: column;
    position: absolute;
    right: 0;
    top: 20px;
    gap: 1rem;
    padding: 0.5rem;
    background-color: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }
  
  .icon-btn {
    background: none;
    border: none;
    cursor: pointer;
    padding: 10px;
    border-radius: 50%;
    transition: background-color 0.3s;
  }
  
  .icon-btn:hover {
    background-color: #f0f0f0;
  }
  
  .icon-btn img {
    width: 24px;
    height: 24px;
  }
  
  .edit-footer {
    display: flex;
    justify-content: center;
    margin-top: 1rem;
  }
  
  .edit-footer .btn {
    padding: 0.75rem 1.5rem;
  }
  
  @media (max-width: 900px) {
    .resume-preview-frame {
      width: 95%;
      padding: 20px;
    }
    
    .resume-header {
      flex-direction: column;
    }
    
    .resume-contact-section {
      text-align: left;
      margin-top: 15px;
    }
    
    .preview-actions {
      position: static;
      flex-direction: row;
      justify-content: center;
      margin-top: 1rem;
      padding: 0;
      background: none;
      box-shadow: none;
    }
    
    .skills-container {
      flex-direction: column;
    }
  }
</style>

<script src="/js/preview-controls.js"></script>
<%- include('partials/footer') %>